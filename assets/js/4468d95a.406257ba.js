"use strict";(self.webpackChunktest_appsmith_docusaurus=self.webpackChunktest_appsmith_docusaurus||[]).push([[928],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),s=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=s(e.components);return a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,d=p(e,["components","mdxType","originalType","parentName"]),c=s(n),m=o,h=c["".concat(l,".").concat(m)]||c[m]||u[m]||i;return n?a.createElement(h,r(r({ref:t},d),{},{components:n})):a.createElement(h,r({ref:t},d))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=c;var p={};for(var l in t)hasOwnProperty.call(t,l)&&(p[l]=t[l]);p.originalType=e,p.mdxType="string"==typeof e?e:o,r[1]=p;for(var s=2;s<i;s++)r[s]=n[s];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},367:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>i,metadata:()=>p,toc:()=>s});var a=n(7462),o=(n(7294),n(3905));const i={description:"This guide will help you migrate your Appsmith instance running on the old stack (multiple containers), to the new stack (single container)."},r="Migrate from Multi-Container setup",p={unversionedId:"getting-started/setup/installation-guides/docker/migrate",id:"getting-started/setup/installation-guides/docker/migrate",title:"Migrate from Multi-Container setup",description:"This guide will help you migrate your Appsmith instance running on the old stack (multiple containers), to the new stack (single container).",source:"@site/docs/getting-started/setup/installation-guides/docker/migrate.md",sourceDirName:"getting-started/setup/installation-guides/docker",slug:"/getting-started/setup/installation-guides/docker/migrate",permalink:"/test-appsmith-docusaurus/getting-started/setup/installation-guides/docker/migrate",draft:!1,editUrl:"https://github.com/jnikhila/test-appsmith-docusaurus/blob/main/test-appsmith-docusaurus/docs/getting-started/setup/installation-guides/docker/migrate.md",tags:[],version:"current",frontMatter:{description:"This guide will help you migrate your Appsmith instance running on the old stack (multiple containers), to the new stack (single container)."},sidebar:"tutorialSidebar",previous:{title:"Docker",permalink:"/test-appsmith-docusaurus/getting-started/setup/installation-guides/docker/"},next:{title:"Heroku",permalink:"/test-appsmith-docusaurus/getting-started/setup/installation-guides/heroku"}},l={},s=[{value:"1. Shutdown old appsmith instance",id:"1-shutdown-old-appsmith-instance",level:2},{value:"2. Export database",id:"2-export-database",level:2},{value:"3. Migrate Configuration",id:"3-migrate-configuration",level:2},{value:"4. Export https config &amp; certificate (optional)",id:"4-export-https-config--certificate-optional",level:2},{value:"5. Setup new Appsmith with Fat container",id:"5-setup-new-appsmith-with-fat-container",level:2},{value:"6. Import database",id:"6-import-database",level:2},{value:"7. Verify migration",id:"7-verify-migration",level:2}],d={toc:s};function u(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"migrate-from-multi-container-setup"},"Migrate from Multi-Container setup"),(0,o.kt)("p",null,"Let's say your current Appsmith instance is located in the folder ",(0,o.kt)("inlineCode",{parentName:"p"},"~/appsmith-old"),", and you'd like the new setup be at ",(0,o.kt)("inlineCode",{parentName:"p"},"~/appsmith-new"),". (This are just example folder names, please use what you prefer.)"),(0,o.kt)("p",null,"Then we can see a rough folder structure like this for ",(0,o.kt)("inlineCode",{parentName:"p"},"~/appsmith-old"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"~/appsmith-old\n\u251c\u2500\u2500 data\n\u2502   \u251c\u2500\u2500 certbot\n\u2502   \u2502   \u251c\u2500\u2500 conf\n\u2502   \u2502   \u2514\u2500\u2500 www\n\u2502   \u251c\u2500\u2500 mongo\n\u2502   \u2502   \u251c\u2500\u2500 db\n\u2502   \u2502   \u2514\u2500\u2500 init.js\n\u2502   \u2514\u2500\u2500 nginx\n\u2502       \u2514\u2500\u2500 app.conf.template\n\u251c\u2500\u2500 docker-compose.yml\n\u251c\u2500\u2500 docker.env\n\u2514\u2500\u2500 encryption.env\n")),(0,o.kt)("p",null,"And like this for ",(0,o.kt)("inlineCode",{parentName:"p"},"~/appsmith-new")," (after the steps in this document are done):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"~/appsmith-new\n\u251c\u2500\u2500 docker-compose.yml\n\u2514\u2500\u2500 stacks\n    \u251c\u2500\u2500 configuration\n    \u2502   \u251c\u2500\u2500 docker.env\n    \u2502   \u2514\u2500\u2500 mongo-init.js\n    \u251c\u2500\u2500 data\n    \u2502   \u251c\u2500\u2500 backup\n    \u2502   \u251c\u2500\u2500 certificate\n    \u2502   \u251c\u2500\u2500 mongodb\n    \u2502   \u2514\u2500\u2500 restore\n    \u2514\u2500\u2500 letsencrypt\n        \u251c\u2500\u2500 accounts\n        \u251c\u2500\u2500 archive\n        \u251c\u2500\u2500 conf\n        \u251c\u2500\u2500 csr\n        \u251c\u2500\u2500 keys\n        \u251c\u2500\u2500 live\n        \u251c\u2500\u2500 options-ssl-nginx.conf\n        \u251c\u2500\u2500 renewal\n        \u251c\u2500\u2500 renewal-hooks\n        \u251c\u2500\u2500 ssl-dhparams.pem\n        \u2514\u2500\u2500 www\n")),(0,o.kt)("p",null,"Now let's go over the steps to be performed."),(0,o.kt)("h2",{id:"1-shutdown-old-appsmith-instance"},"1. Shutdown old appsmith instance"),(0,o.kt)("p",null,"\ud83d\udea8 Please ensure you are aware of the following facts before proceeding:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"This whole migration should take under 25-30mins, usually less than that."),(0,o.kt)("li",{parentName:"ul"},"All users who are currently logged-in, will be logged out. They can just log back in, once the new instance is up and running just fine."),(0,o.kt)("li",{parentName:"ul"},"Depending on your configuration, any ",(0,o.kt)("inlineCode",{parentName:"li"},"docker-compose")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"docker")," commands below might need to be run with a ",(0,o.kt)("inlineCode",{parentName:"li"},"sudo")," at the start."),(0,o.kt)("li",{parentName:"ul"},"Please check the output of commands to see if there's any errors, after running a command, and before proceeding to next steps.")),(0,o.kt)("p",null,"Let's first define a couple of variables that'll be useful during our migration. Please use the appropriate paths in place of ",(0,o.kt)("inlineCode",{parentName:"p"},"~/appsmith-old")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"~/appsmith-new"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"old_path=~/appsmith-old\nnew_path=~/appsmith-new\n")),(0,o.kt)("p",null,"Before we can start the migration, please stop the old server with the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'cd "$old_path"\ndocker-compose stop appsmith-internal-server\n')),(0,o.kt)("h2",{id:"2-export-database"},"2. Export database"),(0,o.kt)("p",null,"To export data from the running ",(0,o.kt)("inlineCode",{parentName:"p"},"MongoDB")," database, we use the ",(0,o.kt)("inlineCode",{parentName:"p"},"mongodump")," command, which will create a ",(0,o.kt)("inlineCode",{parentName:"p"},"gzip")," archive with all the data. This file will then be copied to the new setup and imported."),(0,o.kt)("p",null,"Create backup folder to store dump file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'cd "$old_path"\ndocker-compose exec mongo mkdir -pv /data/db/backup\n')),(0,o.kt)("p",null,"Dumping MongoDB data and compressed into a gzip file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"docker-compose exec mongo sh -c 'mongodump --uri=\"$APPSMITH_MONGODB_URI\" --archive=/data/db/backup/appsmith-data.archive --gzip'\n")),(0,o.kt)("h2",{id:"3-migrate-configuration"},"3. Migrate Configuration"),(0,o.kt)("p",null,"The new setup uses a single ",(0,o.kt)("inlineCode",{parentName:"p"},"docker.env")," file for all environment variable configuration."),(0,o.kt)("p",null,"Let's create the folder structure needed:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'mkdir -pv "$new_path"/stacks/configuration\n')),(0,o.kt)("p",null,"Migrate configuration from old location:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'cat "$old_path"/docker.env "$old_path"/encryption.env >> "$new_path"/stacks/configuration/docker.env\n')),(0,o.kt)("p",null,"Now, in the file ",(0,o.kt)("inlineCode",{parentName:"p"},'"$new_path"/stacks/configuration/docker.env'),":"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Unless you are using an external MongoDB database, in ",(0,o.kt)("inlineCode",{parentName:"li"},"APPSMITH_MONGODB_URI"),", please change the ",(0,o.kt)("inlineCode",{parentName:"li"},"@mongo")," part to ",(0,o.kt)("inlineCode",{parentName:"li"},"@localhost"),", and remove the query params (the ",(0,o.kt)("inlineCode",{parentName:"li"},"?")," and everything after it). For example, if the current value is ",(0,o.kt)("inlineCode",{parentName:"li"},"mongodb://root:rootpass@mongo/appsmith?retryWrites=true&authSource=admin"),", change it to be just ",(0,o.kt)("inlineCode",{parentName:"li"},"mongodb://root:rootpass@localhost/appsmith"),"."),(0,o.kt)("li",{parentName:"ul"},"Unless you are using an external Redis instance, in ",(0,o.kt)("inlineCode",{parentName:"li"},"APPSMITH_REDIS_URL"),", please change ",(0,o.kt)("inlineCode",{parentName:"li"},"redis://redis:6379")," to ",(0,o.kt)("inlineCode",{parentName:"li"},"redis://localhost:6379"),". That is, change the host from ",(0,o.kt)("inlineCode",{parentName:"li"},"redis")," to ",(0,o.kt)("inlineCode",{parentName:"li"},"localhost."))),(0,o.kt)("p",null,"At the end of this ",(0,o.kt)("inlineCode",{parentName:"p"},"docker.env")," file, let's add the following new environment variables:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"APPSMITH_MONGODB_USER=<Your MongoDB User>\nAPPSMITH_MONGODB_PASSWORD=<Your MongoDB Password>\nAPPSMITH_API_BASE_URL=http://localhost:8080\n")),(0,o.kt)("p",null,"Here, in place of ",(0,o.kt)("inlineCode",{parentName:"p"},"<Your MongoDB User>")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"<Your MongoDB Password>"),", please use the same username and password that were given to ",(0,o.kt)("inlineCode",{parentName:"p"},"APPSMITH_MONGODB_URI")," above. In the above example values, these would be ",(0,o.kt)("inlineCode",{parentName:"p"},"root")," for user and ",(0,o.kt)("inlineCode",{parentName:"p"},"rootpass")," for password."),(0,o.kt)("h2",{id:"4-export-https-config--certificate-optional"},"4. Export https config & certificate (optional)"),(0,o.kt)("p",null,"If you are not using a custom domain with your Appsmith instance, please skip this step."),(0,o.kt)("p",null,"If you don't have ",(0,o.kt)("inlineCode",{parentName:"p"},"APPSMITH_CUSTOM_DOMAIN")," already configured in your ",(0,o.kt)("inlineCode",{parentName:"p"},"docker.env"),", please add a line like below"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'echo APPSMITH_CUSTOM_DOMAIN=appsmith.mycustomdomain.com >> "$new_path"/stacks/configuration/docker.env\n')),(0,o.kt)("p",null,"You can also move your certificate to the new container by running following commands:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'mkdir -pv "$new_path"/stacks/letsencrypt\nsudo cp -rfv "$old_path"/data/certbot/conf/* "$new_path"/stacks/letsencrypt\n')),(0,o.kt)("h2",{id:"5-setup-new-appsmith-with-fat-container"},"5. Setup new Appsmith with Fat container"),(0,o.kt)("p",null,"Let's bring down the old instance in-full now:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'docker-compose --file "$old_path"/docker-compose.yml down\n')),(0,o.kt)("p",null,"Follow the official guide to start with a new Appsmith deployment at ",(0,o.kt)("a",{parentName:"p",href:"./#docker-compose-configuration"},"Docker  Compose Configuration"),", also shown here in brief for reference:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'cd "$new_path"\ncurl -L https://bit.ly/32jBNin -o docker-compose.yml\ndocker-compose up -d\n')),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"Please note that you must create a new ",(0,o.kt)("inlineCode",{parentName:"em"},"docker-compose.yml")," in ",(0,o.kt)("inlineCode",{parentName:"em"},'"$new_path"')," folder, like with the ",(0,o.kt)("inlineCode",{parentName:"em"},"curl")," command above. Don't copy it from ",(0,o.kt)("inlineCode",{parentName:"em"},'"$old_path"'),".")),(0,o.kt)("h2",{id:"6-import-database"},"6. Import database"),(0,o.kt)("p",null,"After your new deployment comes up (usually takes ","~","30 seconds), we will import the data that was exported from the old instance:"),(0,o.kt)("p",null,"Create the folder to copy the archive file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'mkdir -pv "$new_path"/stacks/data/restore\n')),(0,o.kt)("p",null,"Copy the archive file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'cp "$old_path"/data/mongo/db/backup/appsmith-data.archive "$new_path"/stacks/data/restore/\n')),(0,o.kt)("p",null,"Import data from this archive:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"docker-compose exec appsmith appsmithctl import_db\n")),(0,o.kt)("p",null,"Note that this will ask you ",(0,o.kt)("inlineCode",{parentName:"p"},"Importing this DB will erase this data. Are you sure you want to proceed"),", where you can respond with ",(0,o.kt)("inlineCode",{parentName:"p"},"y"),". It is safe in this situation since the new database in the new setup only contains initial data and should be safe to be overwritten."),(0,o.kt)("p",null,"Once this is successful, we are ready to bring up our new instance!"),(0,o.kt)("h2",{id:"7-verify-migration"},"7. Verify migration"),(0,o.kt)("p",null,"Navigate to your Appsmith instance, the same way you used to with your old instance, whether using IP address, or custom domain, and verify that your Appsmith instance is working well, and all your data is intact."),(0,o.kt)("p",null,"After this, please designate a user as the superuser, to give them access to the Admin Settings page. You can follow the instructions at ",(0,o.kt)("a",{parentName:"p",href:"../../instance-configuration/admin-settings.md#configuring-a-superuser"},"Configuring a superuser")," to apply this change. diff --git a/setting-up/migrate.md b/setting-up/migrate.md"))}u.isMDXComponent=!0}}]);